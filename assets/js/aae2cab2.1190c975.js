"use strict";(globalThis.webpackChunkrook_db=globalThis.webpackChunkrook_db||[]).push([[424],{9800(e,a,t){t.r(a),t.d(a,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"database-doc","title":"Database Doc","description":"- The codebase is organized into two main directories: frontend and backend.","source":"@site/content/Database-Doc.md","sourceDirName":".","slug":"/database-doc","permalink":"/RookDB/database-doc","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"database-doc","title":"Database Doc"},"sidebar":"tutorialSidebar","previous":{"title":"API Doc","permalink":"/RookDB/API-Doc"},"next":{"title":"Design Doc","permalink":"/RookDB/design-doc"}}');var s=t(4848),r=t(8453);const d={id:"database-doc",title:"Database Doc"},i="Codebase Structure",l={},o=[{value:"Overall Layout of the data",id:"overall-layout-of-the-data",level:2},{value:"Database Directory Layout",id:"database-directory-layout",level:3},{value:"Directory Descriptions",id:"directory-descriptions",level:3},{value:"Catalog File Structure",id:"catalog-file-structure",level:2},{value:"Catalog JSON Structure",id:"catalog-json-structure",level:3},{value:"Example Catalog.json file",id:"example-catalogjson-file",level:4},{value:"Table File Structure",id:"table-file-structure",level:2},{value:"Page Structure",id:"page-structure",level:3}];function c(e){const a={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.header,{children:(0,s.jsx)(a.h1,{id:"codebase-structure",children:"Codebase Structure"})}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["The codebase is organized into two main directories: ",(0,s.jsx)(a.strong,{children:"frontend"})," and ",(0,s.jsx)(a.strong,{children:"backend"}),"."]}),"\n",(0,s.jsxs)(a.li,{children:["All data generated for databases, tables, and tuples is stored in the ",(0,s.jsx)(a.strong,{children:"database"})," directory, which is automatically created when the program is executed."]}),"\n",(0,s.jsxs)(a.li,{children:["The ",(0,s.jsx)(a.strong,{children:"frontend"})," directory contains all code related to command-line interface (CLI) inputs and outputs."]}),"\n",(0,s.jsxs)(a.li,{children:["The ",(0,s.jsx)(a.strong,{children:"backend"})," directory contains the core implementation of the storage manager."]}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"overall-layout-of-the-data",children:"Overall Layout of the data"}),"\n",(0,s.jsxs)(a.p,{children:["All persistent data used and created by the system is stored inside the ",(0,s.jsx)(a.code,{children:"code/database/"})," directory. This directory serves as the root location for both metadata and table data. The folder structure and path constants defined in ",(0,s.jsx)(a.code,{children:"code/src/backend/layout"})," specify how databases and tables are organized as directories and files within this location."]}),"\n",(0,s.jsx)(a.h3,{id:"database-directory-layout",children:"Database Directory Layout"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"database/\n  \u251c\u2500\u2500 global/\n  \u2502   \u2514\u2500\u2500 catalog.json\n  \u2514\u2500\u2500 base/\n      \u251c\u2500\u2500 db1/\n      \u2502   \u2514\u2500\u2500 {table}.dat\n      \u251c\u2500\u2500 db2/\n      \u2502   \u2514\u2500\u2500 {table}.dat\n"})}),"\n",(0,s.jsx)(a.h3,{id:"directory-descriptions",children:"Directory Descriptions"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"database/"}),(0,s.jsx)(a.br,{}),"\n","Root directory for all persistent data used and created by the system."]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"global/"}),(0,s.jsx)(a.br,{}),"\n","Contains system-wide metadata required to interpret database structure."]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"catalog.json"}),(0,s.jsx)(a.br,{}),"\n","Stores metadata for all databases, tables, and their column definitions."]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"base/"}),(0,s.jsx)(a.br,{}),"\n","Contains one subdirectory per database."]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:(0,s.jsx)(a.code,{children:"{database}/"})}),(0,s.jsx)(a.br,{}),"\n","Represents a single database and holds all table files belonging to it."]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:(0,s.jsx)(a.code,{children:"{table}.dat"})}),(0,s.jsx)(a.br,{}),"\n","Physical file corresponding to a table, containing both table metadata and tuple data."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.h2,{id:"catalog-file-structure",children:"Catalog File Structure"}),"\n",(0,s.jsxs)(a.p,{children:["The catalog is stored as a JSON file at ",(0,s.jsx)(a.code,{children:"database/global/catalog.json"}),"."]}),"\n",(0,s.jsx)(a.h3,{id:"catalog-json-structure",children:"Catalog JSON Structure"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-json",children:'{\n  "databases": {\n    "<database_name>": {\n      "tables": {\n        "<table_name>": {\n          "columns": [\n            {\n              "name": "<column_name>",\n              "data_type": "<data_type>"\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(a.h4,{id:"example-catalogjson-file",children:"Example Catalog.json file"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-json",children:'{\n  "databases": {\n    "users": {\n      "tables": {\n        "students": {\n          "columns": [\n            {\n              "name": "id",\n              "data_type": "INT"\n            },\n            {\n              "name": "name",\n              "data_type": "TEXT"\n            }\n          ]\n        },\n        "teachers": {\n          "columns": [\n            {\n              "name": "id",\n              "data_type": "INT"\n            },\n            {\n              "name": "name",\n              "data_type": "TEXT"\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(a.h2,{id:"table-file-structure",children:"Table File Structure"}),"\n",(0,s.jsxs)(a.p,{children:["Each ",(0,s.jsx)(a.code,{children:"{table}.dat"})," file stores table data as a contiguous sequence of bytes and is divided into fixed-size pages. Each page is 8 KB in size."]}),"\n",(0,s.jsxs)(a.p,{children:["The first page of the file is reserved as the ",(0,s.jsx)(a.strong,{children:"Table Header"}),". Within this page, only the first 4 bytes are used to store the total number of pages that contain tuple data. The remaining bytes in the header page are currently unused."]}),"\n",(0,s.jsx)(a.p,{children:"All subsequent pages are data pages used to store tuples."}),"\n",(0,s.jsx)(a.h3,{id:"page-structure",children:"Page Structure"}),"\n",(0,s.jsx)(a.p,{children:"The page structure is based on the PostgreSQL slotted-page layout, with only the minimum required metadata implemented."}),"\n",(0,s.jsxs)(a.p,{children:["For reference, the PostgreSQL page layout is described at:",(0,s.jsx)(a.br,{}),"\n",(0,s.jsx)(a.a,{href:"https://www.postgresql.org/docs/current/storage-page-layout.html#STORAGE-PAGE-LAYOUT-FIGURE",children:"https://www.postgresql.org/docs/current/storage-page-layout.html#STORAGE-PAGE-LAYOUT-FIGURE"})]}),"\n",(0,s.jsx)(a.p,{children:"Each data page is divided into:"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["A ",(0,s.jsx)(a.strong,{children:"page header"}),", which stores the ",(0,s.jsx)(a.code,{children:"lower"})," and ",(0,s.jsx)(a.code,{children:"upper"})," offsets"]}),"\n",(0,s.jsxs)(a.li,{children:["An ",(0,s.jsx)(a.strong,{children:"Item ID array"}),", growing forward from the page header"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Tuple data"}),", appended from the end of the page backward"]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:["The page-related implementation is located in ",(0,s.jsx)(a.code,{children:"src/backend/page/mod.rs"}),"."]})]})}function h(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453(e,a,t){t.d(a,{R:()=>d,x:()=>i});var n=t(6540);const s={},r=n.createContext(s);function d(e){const a=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),n.createElement(r.Provider,{value:a},e.children)}}}]);