"use strict";(globalThis.webpackChunkrook_db=globalThis.webpackChunkrook_db||[]).push([[855],{6002(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"API-Doc","title":"API Doc","description":"Index of APIs","source":"@site/content/API-Doc.md","sourceDirName":".","slug":"/API-Doc","permalink":"/RookDB/API-Doc","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/RookDB/"},"next":{"title":"Database Doc","permalink":"/RookDB/database-doc"}}');var i=t(4848),r=t(8453);const l={},a="API Doc",c={},o=[{value:"Index of APIs",id:"index-of-apis",level:2},{value:"API Descriptions",id:"api-descriptions",level:2},{value:"0. <strong>init_catalog</strong> API",id:"0-init_catalog-api",level:3},{value:"1. <strong>load_catalog</strong> API",id:"1-load_catalog-api",level:3},{value:"2. <strong>create_database</strong> API",id:"2-create_database-api",level:3},{value:"2. <strong>save_catalog</strong> API",id:"2-save_catalog-api",level:3},{value:"3. <strong>create_table</strong> API",id:"3-create_table-api",level:3},{value:"4. <strong>init_table</strong> API",id:"4-init_table-api",level:3},{value:"5. <strong>init_page</strong> API",id:"5-init_page-api",level:3},{value:"6.<strong>page_count</strong> API",id:"6page_count-api",level:3},{value:"7. <strong>create_page</strong> API",id:"7-create_page-api",level:3},{value:"8. <strong>read_page</strong> API",id:"8-read_page-api",level:3},{value:"9.<strong>write_page</strong> API",id:"9write_page-api",level:3},{value:"10. <strong>page_free_space</strong> API",id:"10-page_free_space-api",level:3},{value:"11. Add Tuple",id:"11-add-tuple",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"api-doc",children:"API Doc"})}),"\n",(0,i.jsx)(n.h2,{id:"index-of-apis",children:"Index of APIs"}),"\n",(0,i.jsxs)(n.ol,{start:"0",children:["\n",(0,i.jsx)(n.li,{children:"Init Catalog"}),"\n",(0,i.jsx)(n.li,{children:"Load Catalog"}),"\n",(0,i.jsx)(n.li,{children:"Create Database"}),"\n",(0,i.jsx)(n.li,{children:"Show Databases"}),"\n",(0,i.jsx)(n.li,{children:"Select Database"}),"\n",(0,i.jsx)(n.li,{children:"Show Tables"}),"\n",(0,i.jsx)(n.li,{children:"Save Catalog"}),"\n",(0,i.jsx)(n.li,{children:"Create Table"}),"\n",(0,i.jsx)(n.li,{children:"Init Table"}),"\n",(0,i.jsx)(n.li,{children:"Init Page"}),"\n",(0,i.jsx)(n.li,{children:"Page Count"}),"\n",(0,i.jsx)(n.li,{children:"Create Page"}),"\n",(0,i.jsx)(n.li,{children:"Read Page"}),"\n",(0,i.jsx)(n.li,{children:"Write Page"}),"\n",(0,i.jsx)(n.li,{children:"Page Free Space"}),"\n",(0,i.jsx)(n.li,{children:"Add Tuple to Page"}),"\n",(0,i.jsx)(n.li,{children:"Read Item / Get Tuple"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"api-descriptions",children:"API Descriptions"}),"\n",(0,i.jsxs)(n.h3,{id:"0-init_catalog-api",children:["0. ",(0,i.jsx)(n.strong,{children:"init_catalog"})," API"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"}),(0,i.jsx)(n.br,{}),"\n","Creates ",(0,i.jsx)(n.code,{children:"catalog.json"})," if it doesn\u2019t exist and initializes it with an empty catalog"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{"databases": {}}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn init_catalog()\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Check if database/global/catalog.json exists."}),"\n",(0,i.jsxs)(n.li,{children:["If not, create parent directories and an empty file with data ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:'json{"databases": {}}'})}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"1-load_catalog-api",children:["1. ",(0,i.jsx)(n.strong,{children:"load_catalog"})," API"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Loads the catalog table metadata into memory as a ",(0,i.jsx)(n.strong,{children:"Catalog struct"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn load_catalog() -> Catalog\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Ouput:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Returns a valid Catalog struct containing table metadata."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Reads the catalog file, validates its contents, and deserializes it into a Catalog struct."}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"2-create_database-api",children:["2. ",(0,i.jsx)(n.strong,{children:"create_database"})," API"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Creates a new database in the catalog."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn create_database(catalog: &mut Catalog, db_name: &str) -> Result<(), StorageError>\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Input:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"catalog:"}),"\t in-memory catalog metadata."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"db_name:"}),"\tName of the new database to be created."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Ouput:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Returns Ok on success or an error if creation fails."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Check if the database already exists; if not, insert a new empty entry into catalog.databases."}),"\n",(0,i.jsx)(n.li,{children:"Serialize the updated Catalog and write it to database/global/catalog.json."}),"\n",(0,i.jsxs)(n.li,{children:["Create a new directory at ",(0,i.jsx)(n.code,{children:"database/base/{db_name}"})," for the database\u2019s physical storage."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"2-save_catalog-api",children:["2. ",(0,i.jsx)(n.strong,{children:"save_catalog"})," API"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Writes the in-memory Catalog structure (containing table metadata) back to disk in JSON format."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn save_catalog(catalog: &Catalog)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Input:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"catalog: A reference to a Catalog struct in memory that holds all table definitions."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Ouput:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Writes the catalog data to ",(0,i.jsx)(n.code,{children:"CATALOG_FILE"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Serializes the given Catalog struct into a  JSON string and writes it to the catalog file path."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"3-create_table-api",children:["3. ",(0,i.jsx)(n.strong,{children:"create_table"})," API"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Creates a new table entry in the in-memory Catalog with the provided table name and column definitions."}),"\n",(0,i.jsx)(n.li,{children:"If the table does not already exist, it is added to the catalog and the updated catalog is written to disk in JSON format."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn create_table(catalog: &mut Catalog, table_name: &str, columns: Vec<Column>) \n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Input:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"catalog: A mutable reference to the in-memory Catalog structure that holds metadata for all tables."}),"\n",(0,i.jsx)(n.li,{children:"table_name: A string slice representing the name of the new table to be created."}),"\n",(0,i.jsx)(n.li,{children:"columns: A vector of Column structs, where each struct contains the column name and data type for the new table."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Ouput:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Updates the in-memory Catalog by inserting the new table."}),"\n",(0,i.jsxs)(n.li,{children:["Persists the updated catalog to disk by writing to the CATALOG_FILE in JSON format using ",(0,i.jsx)(n.strong,{children:"save_catalog"})," API."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Checks if a table with the given name already exists in the catalog."}),"\n",(0,i.jsx)(n.li,{children:"If not, creates a new Table struct using the provided columns."}),"\n",(0,i.jsx)(n.li,{children:"Inserts the table into the catalog.tables HashMap."}),"\n",(0,i.jsx)(n.li,{children:"Calls save_catalog(catalog) to serialize and write the updated catalog to disk."}),"\n",(0,i.jsxs)(n.li,{children:["Creates a new data file for the table in ",(0,i.jsx)(n.code,{children:"{TABLE_DIR}/{table_name}.dat"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Initializes the table file header by writing TABLE_HEADER_SIZE bytes of zeros using init_table()."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"4-init_table-api",children:["4. ",(0,i.jsx)(n.strong,{children:"init_table"})," API"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Initializes the ",(0,i.jsx)(n.strong,{children:"Table Header"})," by writing the ",(0,i.jsx)(n.strong,{children:"first page"})," (8192 bytes) into the table file with 0's. The first 4 bytes represent the ",(0,i.jsx)(n.strong,{children:"Page Count"})," (1)."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn init_table(file: &mut File)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Input:"}),"\n",(0,i.jsx)(n.code,{children:"file:"})," File pointer to update Table Header."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output:"}),"\nTable header (first page) initialized with page_count = 1 in the first 4 bytes and remaining bytes set to zero."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Move the file cursor to the beginning of the file."}),"\n",(0,i.jsxs)(n.li,{children:["Allocate a buffer of 8192 bytes (",(0,i.jsx)(n.strong,{children:"TABLE_HEADER_SIZE"}),") initialized to zero."]}),"\n",(0,i.jsx)(n.li,{children:"Write the entire 8192-byte buffer (including the page count) to disk, marking the creation of the first table page."}),"\n",(0,i.jsxs)(n.li,{children:["Write another 8192-byte buffer to disk to initialize the first data page along with page headers using ",(0,i.jsx)(n.code,{children:"create_page"})," API (Page 1), which will store table tuples."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"5-init_page-api",children:["5. ",(0,i.jsx)(n.strong,{children:"init_page"})," API"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Description:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Initializes the ",(0,i.jsx)(n.strong,{children:"Page Header"})," with two offset values for ",(0,i.jsx)(n.strong,{children:"In Memory Page"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lower Offset"})," (",(0,i.jsx)(n.code,{children:"PAGE_HEADER_SIZE"}),") \u2192 bytes 0..4"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Upper Offset"})," (",(0,i.jsx)(n.code,{children:"PAGE_SIZE"}),") \u2192 bytes 4..8"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn init_page(page:&mut Page)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Input:"}),"\n",(0,i.jsx)(n.code,{children:"page:"})," ",(0,i.jsx)(n.strong,{children:"In Memory Page"})," to set Header - Lower and Upper Offsets."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output:"}),"\nPage header updated with lower and upper offsets."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Write the lower offset (",(0,i.jsx)(n.code,{children:"PAGE_HEADER_SIZE"}),") into the first 4 bytes of the page header (0..4)."]}),"\n",(0,i.jsxs)(n.li,{children:["Write the upper offset (",(0,i.jsx)(n.code,{children:"PAGE_SIZE"}),") into the next 4 bytes of the page header (4..8)."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"6page_count-api",children:["6.",(0,i.jsx)(n.strong,{children:"page_count"})," API"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"}),"\nTo get total number of pages in a file"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn page_count(file: &mut File)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Input:"}),"\n",(0,i.jsx)(n.code,{children:"file:"})," file to calculate number of pages."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output:"}),"\nTotal number of pages present in the file."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Use the ",(0,i.jsx)(n.strong,{children:"read_page()"})," function to read the first page (page ID 0) from the file into memory."]}),"\n",(0,i.jsxs)(n.li,{children:["Extract the ",(0,i.jsx)(n.strong,{children:"first 4 bytes"})," from the in-memory page buffer \u2014 these bytes represent the page count stored in the table header."]}),"\n",(0,i.jsx)(n.li,{children:"Return the first 4 bytes as page count."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"7-create_page-api",children:["7. ",(0,i.jsx)(n.strong,{children:"create_page"})," API"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"}),(0,i.jsx)(n.br,{}),"\n","Create a page in disk for a file."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn create_page(file: &mut File)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Input:"}),"\n",(0,i.jsx)(n.code,{children:"file:"})," file to create to a file"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Output:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create a page at the end of the file."}),"\n",(0,i.jsxs)(n.li,{children:["Update the File Header with ",(0,i.jsx)(n.strong,{children:"Page Count"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Initializes a new page ",(0,i.jsx)(n.strong,{children:"in memory"})," using ",(0,i.jsx)(n.strong,{children:"init_page"})," API (update page header - lower and upper)."]}),"\n",(0,i.jsxs)(n.li,{children:["Reads the ",(0,i.jsx)(n.strong,{children:"current page count"})," from the file using the ",(0,i.jsx)(n.strong,{children:"page_count"})," API."]}),"\n",(0,i.jsx)(n.li,{children:"Moves the file cursor to the end of the file."}),"\n",(0,i.jsxs)(n.li,{children:["Writes the initialized in-memory page to the file and ",(0,i.jsx)(n.strong,{children:"updates the file header"})," by incrementing the page count stored in the first 4 bytes."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"8-read_page-api",children:["8. ",(0,i.jsx)(n.strong,{children:"read_page"})," API"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"}),(0,i.jsx)(n.br,{}),"\n","Reads a page from a disk/file into memory."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn read_page(file: &mut File, page: &mut Page, page_num: u32)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Input:"}),"\n",(0,i.jsx)(n.code,{children:"file:"})," file to read from,\n",(0,i.jsx)(n.code,{children:"page:"})," memory page to fill,\n",(0,i.jsx)(n.code,{children:"page_num:"})," page number to read"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output:"}),"\nPopulates the given memory page with data read from the file."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Calculates the ",(0,i.jsx)(n.strong,{children:"offset"})," as ",(0,i.jsx)(n.strong,{children:"(page_num * PAGE_SIZE)"})," and moves the file cursor to the correct position."]}),"\n",(0,i.jsxs)(n.li,{children:["Reads data from that offset position up to ",(0,i.jsx)(n.strong,{children:"offset + PAGE_SIZE"})," and copies it into the page memory."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cases Handled:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Checks the file size and returns an error if the requested page does not exist in the file."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"9write_page-api",children:["9.",(0,i.jsx)(n.strong,{children:"write_page"})," API"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"}),(0,i.jsx)(n.br,{}),"\n","Write a page from memory to disk/file."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn write_page(file: &mut File, page: &mut Page, page_num: u32)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Input:"}),"\n",(0,i.jsx)(n.code,{children:"file:"})," file to write,\n",(0,i.jsx)(n.code,{children:"page:"})," memory page to copy from,\n",(0,i.jsx)(n.code,{children:"page_num:"})," page number to write"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output:"}),"\nWrites the contents of the given memory page to the file at the specified page offset."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Calculates the ",(0,i.jsx)(n.strong,{children:"offset"})," as ",(0,i.jsx)(n.code,{children:"page_num * PAGE_SIZE"})," and moves the file cursor to the correct position."]}),"\n",(0,i.jsxs)(n.li,{children:["copy the contents of the given memory page from offset to ",(0,i.jsx)(n.code,{children:"offset + PAGE_SIZE"})," positions to the file."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"10-page_free_space-api",children:["10. ",(0,i.jsx)(n.strong,{children:"page_free_space"})," API"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"}),(0,i.jsx)(n.br,{}),"\n","To calculate the total amount of free space left in the page."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:"pub fn page_free_space(page: &Page) \n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Input:"}),"\n",(0,i.jsx)(n.code,{children:"page:"})," page to calculate the free space."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output:"}),"\nTotal amount of freespace left in the page."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Read the ",(0,i.jsx)(n.code,{children:"lower pointer"})," from the first 4 bytes of the page."]}),"\n",(0,i.jsxs)(n.li,{children:["Read the ",(0,i.jsx)(n.code,{children:"upper pointer"})," from the next 4 bytes of the page."]}),"\n",(0,i.jsxs)(n.li,{children:["Calculate ",(0,i.jsx)(n.code,{children:"free space"}),"  = ",(0,i.jsx)(n.code,{children:"upper - lower"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Return the free space."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"11-add-tuple",children:"11. Add Tuple"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"}),"\nAdds raw data to the file."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Function:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In the buffer manager load_csv_into_pages function."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Output:"}),"\nData inserted in the file."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Get the ",(0,i.jsx)(n.strong,{children:"total number of pages"})," in the file using ",(0,i.jsx)(n.a,{href:"#4page_count-api",children:(0,i.jsx)(n.code,{children:"page_count"})})," API."]}),"\n",(0,i.jsxs)(n.li,{children:["Read the ",(0,i.jsx)(n.strong,{children:"last page"})," into memory using ",(0,i.jsx)(n.a,{href:"#2-read_page-api",children:(0,i.jsx)(n.code,{children:"read_page"})})," API."]}),"\n",(0,i.jsxs)(n.li,{children:["Check ",(0,i.jsx)(n.strong,{children:"free space"})," in the page using ",(0,i.jsx)(n.a,{href:"#5-page_free_space-api",children:(0,i.jsx)(n.code,{children:"page_free_space"})})," API."]}),"\n",(0,i.jsxs)(n.li,{children:["If the last page has enough free space to store the data and its ItemId\n(i.e., if ",(0,i.jsx)(n.code,{children:"free_space >= data.size() + ITEM_ID_SIZE"}),"):\na. Calculate the ",(0,i.jsx)(n.strong,{children:"insertion offset"})," from the upper pointer.\n",(0,i.jsx)(n.code,{children:"start = upper - data.len()"}),"\nb. Copy the data bytes into the page buffer starting at this offset.\nc. Update the ",(0,i.jsx)(n.strong,{children:"upper pointer"})," in the page header to the new start of free space.\nd. Write the ",(0,i.jsx)(n.strong,{children:"ItemId entry"})," (offset and length of the data) at the position indicated by the lower pointer.\ne. Update the ",(0,i.jsx)(n.strong,{children:"lower pointer"})," in the page header to account for the newly added ItemId (",(0,i.jsx)(n.code,{children:"lower += ITEM_ID_SIZE"}),").\nf. Write the updated page back to disk using ",(0,i.jsx)(n.a,{href:"#3write_page-api",children:(0,i.jsx)(n.code,{children:"write_page"})})," API."]}),"\n",(0,i.jsx)(n.li,{children:"If the last page does not have enough free space:\na. Create a new page in the file and add the tuple in the new page."}),"\n"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://hemanth-sunkireddy.github.io/Storage-Manager/storage_manager/all.html",children:"Code Documentation"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reference"}),": ",(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/storage-page-layout.html",children:"Postgres Internals \u2013 Page Layouts & Data"})]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," Some APIs have undergone slight implementation changes during development. So, some of the implementation steps might not aligned with the actual code functions."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>l,x:()=>a});var s=t(6540);const i={},r=s.createContext(i);function l(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);